
{% load static %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>Title</title>
        <style type="text/css">
            @page {
                size: a4 portrait;
                @frame header_frame {           /* Static Frame */
                    -pdf-frame-content: header_content;
                    left: 50pt; width: 512pt; top: 20pt; height: 40pt;
                }
                @frame content_frame {          /* Content Frame */
                    left: 50pt; width: 512pt; top: 60pt; height: 750pt;
                }
                @frame footer_frame {           /* Another static Frame */
                    -pdf-frame-content: footer_content;
                    left: 50pt; width: 512pt; top: 810pt; height: 20pt;
                }
            } 
            body {
                font-weight: 100;
                font-size: 9px;
            }
            .font-big {
                font-size: large;
            }
            div p{
                display: inline-block;
                margin-right: 15px !important;
            }

            table tr td {
                white-space: nowrap;
            }
            th {
                background-color: #bfbfbfd3;
            }
        </style>
    </head>

    <div id="header_content">
        <div>   
            <img src="https://i.imgur.com/mzCv7nr.jpg" alt="Logo" width="150px" height="40px" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);">
        </div>   
    </div>
    <body>
       
        <div style="text-align: center;"  class="font-big">
            <h2>{% if user.user_type == "0" %}Service Request Report {% else %}Call Back Report {% endif %}</h3>        
            {% if unit %}
            <p><b>Unit: </b>{{unit.name}}</p>
            {% else %}
            <p><b>Unit: </b> All</p>
            {% endif %}

            {% if status >= 0 %}
            <p><b>Status: </b> {{status_level}}</p>
            {% else %}
            <p><b>Status: </b> All</p>
            {% endif %}

            {% if from_date and to_date %}
            <p><b>From: </b>{{from_date}} <b>to: </b> {{to_date}}</p>
            {% elif from_date %}
            <p><b>From: </b> {{from_date}} to Present</p>
            {% elif to_date %}
            <p><b>Till: </b> {{to_date}}</p>
            {% else %}
            <p><b>Timeline: </b>All</p>
            {% endif %}
            <p> <b>Generated at: </b>  {% now "jS F Y H:i" %} </p>
        
        </div>
        
        <table style="border: 0.5px solid black ; text-align: center; vertical-align: middle; padding-top: 2px ;">
            <thead>
                <tr>
                    <th style="width: 4%;">SL</th>
                    <th style="width: 10%;">{% if user.user_type == "0" %}Reqeust Time{% else %}Call Date{% endif  %}</th>
                    <th style="width: 10%;">Project</th>
                    <th style="width: 10%;">{% if user.user_type == "0" %} Service Request {% else %}Client's Complain {% endif %}</th>
                    <th style="width: 6%;">Status</th>
                    <th style="width: 10%;">{% if user.user_type == "0" %}Responsible Person {% else %}Complain By {% endif%}</th>
                    <th style="width: 10%;">Response Time</th>
                    <th style="width: 10%;">Responsed By</th>
                    <th style="width: 15%;">{% if user.user_type == "0" %}Observation {%else %}Problem{% endif %}</th>
                    <th style="width: 20%;">{% if user.user_type == "0" %}Feedback{% else %}Solution {% endif%}</th>
                </tr>
            </thead>
            <tbody>
                {% for callback in callbacks %}
                <tr>
                    <td>{{forloop.counter}}</td>
                    <td>{{callback.call_date}}</td>
                    <td>{{callback.unit}}</td>
                    <td>{{callback.client_complain}}</td>
                    <td>{{callback.get_status_display}}</td>
                    <td>{{callback.called_by}}</td>
                    <td>{{callback.callresponse_set.all.0.response_time}}</td>
                    <td>{{callback.callresponse_set.all.0.response_by.name}}</td>
                    <td>{{callback.callresponse_set.all.0.problem}}</td>
                    <td>{{callback.callresponse_set.all.0.solution}}</td>
                </tr>

                    {% for response in callback.callresponse_set.all %}
                        {% if forloop.counter != 1 %}
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td>{{response.response_time}}</td>
                            <td>{{response.response_by.name}}</td>
                            <td>{{response.problem}}</td>
                            <td>{{response.solution}}</td>
                        </tr>
                        {% endif %}
                    {% endfor %}

                {% endfor %}
            </tbody>
        </table>

        <div id="footer_content" style="text-align:right">Page  <pdf:pagenumber>  of  <pdf:pagecount>  </div>
    </body>
</html>